#!/bin/sh
cd ${0%/*} || exit 1    # run from this directory

# Source tutorial run functions
. $WM_PROJECT_DIR/bin/tools/RunFunctions

export AMRLB_PROJECT=$HOME/repos/blastAMR
export FOAM_CODE_TEMPLATES=$AMRLB_PROJECT/etc/codeTemplates/dynamicCode

set -e
rm -rf 0 && cp -rT 0.org 0 
find . -iname "*template" -exec rm {} \;
runApplication blockMesh
runApplication checkMesh
runApplication setFields
maxRef=$(foamDictionary -entry maxRefinement -value constant/dynamicMeshDict)
for i in $(seq 1 "$maxRef"); do
    runApplication -a updateMesh -overwrite
    runApplication -a setFields
done
runApplication decomposePar
mpirun -np 4 interFlow -parallel

#application $(getApplication)

#runApplication  $(getApplication) 

# ----------------------------------------------------------------- end-of-file
